
== Azure Database for MySQL server not configured with private endpoint

=== Policy Details

[width=45%]
[cols="1,1"]
|===
|Prisma Cloud Policy ID
| 19c4d9f1-a1fd-4e53-a3ca-4eedc720ec36

|Checkov ID
| https://github.com/bridgecrewio/checkov/blob/main/checkov/terraform/checks/graph_checks/azure/AzureMySQLserverConfigPrivEndpt.yaml[CKV2_AZURE_44]

|Severity
|MEDIUM

|Subtype
|Run,Build

|Frameworks
|Terraform,TerraformPlan

|===

=== Description

This policy identifies Azure MySQL database servers that are not configured with private endpoint. Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MySQL. Configuring a private endpoint enables access to traffic coming from only known networks and prevents access from malicious or unknown IP addresses which includes IP addresses within Azure. It is recommended to create private endpoint for secure communication for your Azure MySQL database.

=== Fix - Buildtime

*Terraform*

* *Resource:* azurerm_mysql_server, azurerm_private_endpoint
* *Arguments:* private_connection_resource_id

To fix this issue, you need to create a private endpoint for your Azure MySQL server to establish secure connectivity with your network.

[source,go]
----
resource "azurerm_mysql_server" "example" {
  name                = "example-mysql-server"
  //...
}

resource "azurerm_private_endpoint" "example" {
  name                = "example-private-endpoint"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name
  subnet_id           = azurerm_subnet.example.id

  private_service_connection {
    name                           = "example-privateserviceconnection"
    private_connection_resource_id = azurerm_mysql_server.example.id
    subresource_name               = "mysqlServer"
    is_manual_connection           = false
  }
}
----

The previous code sets up a private endpoint for the Azure MySQL server. Having a private endpoint helps to ensure that traffic between your virtual network and the service traverses over the Azure network only, eliminating exposure from the public Internet.

