
== IAM policy document allows all resources with restricted actions

=== Policy Details

[width=45%]
[cols="1,1"]
|===
|Prisma Cloud Policy ID
| d9b86448-11a2-f9d4-74a5-f6fc590caeef

|Checkov ID
| https://github.com/bridgecrewio/checkov/blob/main/checkov/terraform/checks/resource/aws/IAMStarResourcePolicyDocument.py[CKV_AWS_355]

|Severity
|HIGH

|Subtype
|Build

|Frameworks
|Terraform,TerraformPlan

|===

=== Description

This policy is checking to ensure that no IAM (Identity and Access Management) policy documents allow "\*" as a statement's resource for actions that can and should be restricted. Prisma Cloud checks the AWS documentation for IAM actions that can be restricted to a resource and recommends defining a specific resource rather than "\*". If "\*", which stands for all resources, is used, it means the statement grants permissions to all AWS resources which is potentially unsafe. This is poor practice because it broadens the scope of access controls and increases the risk of unauthorized access. It's important to define granular permissions to each user access, as unrestricted access can lead to unwanted manipulations or data breaches. Therefore, it's recommended to specify restrictions and assign minimum necessary access rights.

=== Fix - Buildtime

*Terraform*

* *Resource:* aws_iam_policy
* *Arguments:* policy

Firstly, check your AWS IAM policy and identify if there are any resources where action is allowed to "*". This kind of policy allows full access to all resources which can potentially lead to security risks like unauthorized access to data, service disruption etc. 

Here's an example of a secure piece of Terraform code:

[source,go]
----
resource "aws_iam_policy" "example" {
  name        = "test_policy"
  path        = "/"
  description = "My test policy"

  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Action = [
          "states:CreateStateMachine",
        ]
        Effect   = "Allow"
-        Resource = "*"
+        Resource = "arn:aws:<resource_type>:::<myresource>"
      },
    ]
  })
}
----

The fix here is to provide specified resources in the policy instead of `"*"` for the field `Resource` within the respective `Statement` block.

