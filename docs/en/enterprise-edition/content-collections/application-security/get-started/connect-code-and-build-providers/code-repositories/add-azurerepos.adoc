:topic_type: task

[.task]
== Connect Azure Repos

Integrate Prisma Cloud with your Azure Repos system to gain visibility into, and monitor the systems, technologies, configurations, and pipelines that make up the Azure Repos platform.
This integration enables security scans to identify Infrastructure-as-Code (IaC) misconfigurations, Software Composition Analysis (SCA) vulnerabilities, exposed secrets, license mis-compliance and CI/CD pipeline risks in your Azure Repos, allowing you to understand and fix issues as soon as they are detected, resulting in an enhanced security posture for your organization.

[.procedure]

. Before you begin:
.. Add the Prisma Cloud IP addresses and hostname for Application Security to an https://docs.paloaltonetworks.com/prisma/prisma-cloud/prisma-cloud-admin/get-started-with-prisma-cloud/enable-access-prisma-cloud-console.html[allow list], to enable access to the Prisma Cloud Console
.. Grant *Administrator* permissions in the relevant Azure organization to the Prisma user integrating Prisma Cloud with Bitbucket

.. On the Azure DevOps console.
+
* Enable third-party application access to Azure DevOps via OAuth to configure integration for both single organization and multiple organizations using a single user token. Do not limit authorization scope
+
image::application-security/azure-third-party-oauth.png
+
* To ensure that Prisma Cloud has access to repositories, ensure the *Limit job authorization scope to current project for non-release pipelines* is set to *OFF*. You can configure this setting on *Project Settings > Settings > General*.
+
image::application-security/azure-permission-settings.png
+
See https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/change-application-access-policies?view=azure-devops[third-party application access via OAuth] for more information on Prisma Cloud access to all organizations associated with your user token.

. On the Prisma Cloud Application Security console.
.. In Application Security, select *Settings > *Connect Provider* > *Code & Build Providers* > *Azure Repos* (under Code Repositories).
.. Select *Single Organization* or *Multiple Organizations* in the *Configure Account* step of the installation wizard that is displayed.
+
NOTE: *Multiple Organizations* sets up an Azure Repos account that covers multiple organizations. 
.. Select *Authorize*
+
You are redirected to Azure Repos to authorize Prisma Cloud access.

. Authorize Prisma Cloud on Azure Devops.
.. Review the requested permissions and then select *Accept* to authorize the Prisma Cloud console to access your organization account and repositories.
+
You are redirected to the *Enable CI/CD Security (Optional)* step of the Azure Repos installation wizard on the Prisma Cloud console. This step is optional and provides protection for the CI/CD systems in your Azure Repos environment. 

. Enable CI/CD Security.
.. To begin, you must first enable the xref:../../code-security-licensing-configuration.adoc[CI/CD Security Module].
.. Fill in the provided fields. 
+
* Azure *User Name*: Access your Azure organization and then select *User settings > Profile*.
* Azure *App Password*. In Azure, generate a https://learn.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=Windows[Personal Access Token] (PAT) > make a copy for safekeeping > add the PAT in the App Password field.
+  
When creating the new PAT use these values:

* Set an *Expiration* date through *Organization > all accessible organizations*.

* Scope the authorization access for the token.

** Agent Pools (Read)

** Analytics (Read)

** Auditing (Read Audit Log)

** Member Entitlement Management (Read)

** Pull Request Threads (Read & write)

** Service Connections (Read)

** Tokens (Read & manage)

** Variable Groups (Read)

.. Select *Next*.

. Select which repositories will be scanned: 
+
* *Permit all existing repositories* 
* *Permit all existing and future repositories*.  This is the recommended option to ensure complete coverage and successful operation of all features. 
* *Choose from repository list* > Select repositories
+
The selected repositories associated with the PAT will be scanned.
+
NOTE: A single repository may be shared across one or more user tokens. In this case, any change made to a shared repository scan applies to all associated user tokens.

. Select *Next* to confirm the repository selection and save the changes.

. Select *Done* in the *Status* step of the wizard to complete the integration.
+
Your selected Azure repositories will be visible on the *Repositories* page. The next Azure Repos scan will include the selected repositories. 

. Verify successful integration: select *Settings* > *Code & Build Providers*.
+
Confirm that the status of the integrated *Azure* repositories displays *Connected* under *Status*.
+
NOTE: It may take up to 3 minutes for the integration status to be updated and show as *Succeeded*.

. Next step: Monitor and manage scan results.
+
Your selected Azure repositories will be visible on the *Repositories* page. The next Azure scan will include the selected repositories. 

To view scan results and resolve issues, select *Application Security* > *Projects*. See xref:../../../risk-management/monitor-code-build-issues.adoc[here] for more information.  


=== Manage integrations

On *Code & Build Providers*, you can also manage the integration by reselection of repositories and deletion of the repository and the integration.

* *Reselect repositories*: Enables you to access the list of repositories for a scan.
* *Delete repository*: Enables you to delete repositories for a scan from the account.
* *Manage VCS user tokens*: Enables you to integrate one or more Azure Repos accounts.
+
NOTE: You cannot delete the integration from *Repositories* for an account integration that supports multiple user tokens.

